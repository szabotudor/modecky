#!/bin/bash

set -e

# Get the current folder name (used as plugin folder name inside the zip)
PLUGIN_NAME="$(basename "$PWD")"
ZIP_DEST="$HOME/${PLUGIN_NAME}.zip"

# Build the plugin
pnpm run build

# Create a temporary packaging directory
TMP_DIR="$(mktemp -d)"
PLUGIN_DIR="$TMP_DIR/$PLUGIN_NAME"
mkdir -p "$PLUGIN_DIR"

# Copy required files and folders
cp -r ./assets "$PLUGIN_DIR/"
cp -r ./dist "$PLUGIN_DIR/"
cp -r ./src "$PLUGIN_DIR/"
cp ./LICENSE "$PLUGIN_DIR/" 2>/dev/null || true
cp ./main.py "$PLUGIN_DIR/"
cp ./package.json "$PLUGIN_DIR/"
cp ./plugin.json "$PLUGIN_DIR/"
cp ./README.md "$PLUGIN_DIR/" 2>/dev/null || true

# Create the zip
cd "$TMP_DIR"
zip -r "$ZIP_DEST" "$PLUGIN_NAME"

# Cleanup
rm -rf "$TMP_DIR"

echo "âœ… Created: $ZIP_DEST"
